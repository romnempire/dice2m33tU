function dropInImage(url){$("#map").append("<img src="+url+' class="toy draggable">'),$(".draggable").draggable({containment:"parent",start:handleDragStart,stop:handleDragStop,drag:handleDragDrag}),$("draggable").on(),$("#urlchooser").remove()}function createURLChooser(_this){var posn=$(_this).position();console.log(posn.left),console.log(posn.top),0===$("#urlchooser").length?($("#options").append('<div id="urlchooser"><input type="text"><button onclick="dropInImage($(\'#urlchooser > input\').val())">GO</button></div>'),$("#urlchooser").css("position","absolute"),$("#urlchooser").css({left:-.5*$("#urlchooser").width(),top:-1.1*$("#urlchooser").height()})):$("#urlchooser").remove()}function handleDropEvent(e,ui){var draggable=ui.draggable;draggable.css("toybox"===$(this).attr("id")?{left:draggable.position().left-$("#toybox").position().left,top:draggable.position().top-$("#toybox").position().top-$("#toybox > h2").height()-40}:"map"===$(this).attr("id")?{left:draggable.position().left+$("#toybox").position().left,top:draggable.position().top}:{left:"0px",top:"0px"}),$(this).append(draggable)}function handleDragStart(){"map"===$(this).parent().attr("id")?$("#map").droppable({disabled:!0}):console.log($(this).parent().attr("id")),"toybox"===$(this).parent().attr("id")&&$("#map, #toybox").droppable({disabled:!0})}function handleDragDrag(e,ui){"toybox"===$(this).parent().attr("id")&&(Math.abs(ui.position.top)>$("#toybox").height()||Math.abs(ui.position.left)>$("#toybox").width())&&$("#map").droppable({disabled:!1})}function handleDragStop(){$("#map, #toybox").droppable({disabled:!1})}var socket=io.connect("http://127.0.0.1:1337/"),app=app||{};$(function(){var $blastField=$("#blast"),$allPostsTextArea=$("#allPosts"),$clearAllPosts=$("#clearAllPosts"),$sendBlastButton=$("#send"),$mapField=$("#map");socket.on("blast",function(data){var copy=$allPostsTextArea.html();$allPostsTextArea.html("<p>"+copy+data.msg+"</p>"),$allPostsTextArea.scrollTop($allPostsTextArea[0].scrollHeight-$allPostsTextArea.height())}),socket.on("onthemap",function(data){var copy=$allPostsTextArea.html();$allPostsTextArea.html("<p>"+copy+data.y+data.x+"</p>"),$allPostsTextArea.scrollTop($allPostsTextArea[0].scrollHeight-$allPostsTextArea.height())}),$clearAllPosts.click(function(){$allPostsTextArea.text("")}),$sendBlastButton.click(function(){var blast=$blastField.val();blast.length&&socket.emit("blast",{msg:blast},function(){$blastField.val("")})}),$blastField.keydown(function(e){13==e.keyCode&&$sendBlastButton.trigger("click")}),$mapField.click(function(e){socket.emit("onthemap",{x:e.pageX,y:e.pageY},function(){$blastField.val("")})})}),$("#map, #toybox").droppable({accept:".toy",drop:handleDropEvent}),$("#toybox").draggable({containment:"parent"});
