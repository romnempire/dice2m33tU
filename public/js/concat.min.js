function dropInImage(url){$("#map").append("<img src="+url+' class="toy draggable">'),$(".draggable").draggable({containment:"parent",start:handleDragStart,stop:handleDragStop,drag:handleDragDrag}),$("draggable").on(),$("#urlchooser").remove()}function createURLChooser(_this){var posn=$(_this).position();console.log(posn.left),console.log(posn.top),0===$("#urlchooser").length?($("#options").append('<div id="urlchooser"><input type="text"><button onclick="dropInImage($(\'#urlchooser > input\').val())">GO</button></div>'),$("#urlchooser").css("position","absolute"),$("#urlchooser").css({left:-.5*$("#urlchooser").width(),top:-1.1*$("#urlchooser").height()})):$("#urlchooser").remove()}function handleDropEvent(e,ui){var draggable=ui.draggable;draggable.css("toybox"===$(this).attr("id")?{left:draggable.position().left-$("#toybox").position().left,top:draggable.position().top-$("#toybox").position().top-$("#toybox > h2").height()-40}:"map"===$(this).attr("id")?{left:draggable.position().left+$("#toybox").position().left,top:draggable.position().top}:{left:"0px",top:"0px"}),$(this).append(draggable)}function handleDragStart(){"map"===$(this).parent().attr("id")?$("#map").droppable({disabled:!0}):console.log($(this).parent().attr("id")),"toybox"===$(this).parent().attr("id")&&$("#map, #toybox").droppable({disabled:!0})}function handleDragDrag(e,ui){"toybox"===$(this).parent().attr("id")&&(Math.abs(ui.position.top)>$("#toybox").height()||Math.abs(ui.position.left)>$("#toybox").width())&&$("#map").droppable({disabled:!1})}function handleDragStop(){$("#map, #toybox").droppable({disabled:!1})}var socket=io.connect("http://127.0.0.1:1337/"),app=app||{};$(function(){var $blastField=$("#blast"),$allPostsTextArea=$("#allPosts"),$clearAllPosts=$("#clearAllPosts"),$sendBlastButton=$("#send"),$mapField=$("#map");socket.on("blast",function(data){var copy=$allPostsTextArea.html();$allPostsTextArea.html("<p>"+copy+data.msg+"</p>"),$allPostsTextArea.scrollTop($allPostsTextArea[0].scrollHeight-$allPostsTextArea.height())}),socket.on("onthemap",function(data){var copy=$allPostsTextArea.html();$allPostsTextArea.html("<p>"+copy+data.y+data.x+"</p>"),$allPostsTextArea.scrollTop($allPostsTextArea[0].scrollHeight-$allPostsTextArea.height())}),$clearAllPosts.click(function(){$allPostsTextArea.text("")}),$sendBlastButton.click(function(){var blast=$blastField.val();blast.length&&socket.emit("blast",{msg:blast},function(){$blastField.val("")})}),$blastField.keydown(function(e){13==e.keyCode&&$sendBlastButton.trigger("click")}),$mapField.click(function(e){socket.emit("onthemap",{x:e.pageX,y:e.pageY},function(){$blastField.val("")})})}),$("#map, #toybox").droppable({accept:".toy",drop:handleDropEvent}),$("#toybox").draggable({containment:"parent"}),$(document).ready(function(){$("#grid").griddy({rows:Math.floor($("#map").width()/100),rowheight:100,rowgutter:5,columns:Math.floor($("#map").width()/100),columnwidth:100,columngutter:5})}),$.fn.griddy=function(options){this.css("position","relative");var defaults={rows:10,rowheight:0,rowgutter:20,columns:4,columnwidth:0,columngutter:20,color:"#ccc",opacity:30},opts=$.extend(defaults,options),o=$.meta?$.extend({},opts,$$.data()):opts,width=this.width(),height=$(document).height();if(0==o.columnwidth&&(o.columnwidth=Math.floor(width-(o.columns-1)*o.columngutter)/o.columns),0==o.rowheight&&(o.rowheight=Math.floor(height-(o.rows-1)*o.rowgutter)/o.rows),this.prepend("<div class='griddy' style='display:none;overflow:hidden;position:absolute;left:0;top:0;width:100%;height:"+(height-20)+"px;'><div class='griddy-r' style='position:relative;width:100%;height:100%;display:block;overflow:hidden;'><div class='griddy-columns' style='position:absolute;top:0;left:0;width:100%;height:100%;'></div></div></div>"),0!=o.columns)for(var i=0;i<o.columns;i++)0!=i&&$(".griddy-r").append("<div style='width:"+o.columngutter+"px;display:inline;float:left;height:100%;'></div>"),$(".griddy-r",this).append("<div style='width:"+o.columnwidth+"px;height:100%;display:block;float:left;text-align:center;position:relative;'><div style='width:100%;height:100%;position:absolute;top:0;left:0;display:block;background:"+o.color+";opacity:"+o.opacity/100+";filter:alpha(opacity="+o.opacity+");'></div></div>");if(0!=o.rows)for(var i=0;i<o.rows;i++)0!=i&&$(".griddy-columns").append("<div style='height:"+o.rowgutter+"px;display:block;float:left;width:100%;'></div>"),$(".griddy-columns",this).append("<div style='height:"+o.rowheight+"px;width:100%;float:left;display:block;line-height:"+o.rowheight+"px;position:relative;'><div style='width:100%;height:100%;position:absolute;top:0;left:0;display:block;background:"+o.color+";opacity:"+o.opacity/100+";filter:alpha(opacity="+o.opacity+");'></div></div>")};